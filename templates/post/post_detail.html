{% extends "base.html" %}
{% load static %}
{% block og %} {{post.title}} {% endblock og %}
{% block twitter %} {{post.title}} {% endblock twitter %}
{% block description_og %} {{ post.body|truncatechars:200 }} {% endblock description_og %}
{% block description_twitter %} {{ post.body|truncatechars:200 }} {% endblock description_twitter %}
{% block keywords %} {{ post.body|truncatechars:80 }} {% endblock keywords %}
{% block description %} {{ post.body|truncatechars:160 }} {% endblock description %}
{% block title %}{{post.title}}{% endblock title %} 
{% block content %}

<!-- Page Title (Light)-->
<div class="bg-secondary py-4">
    <div class="container d-lg-flex justify-content-between py-2 py-lg-3">
        <div class="order-lg-2 mb-3 mb-lg-0 pt-lg-2">
            <nav aria-label="breadcrumb">
            <ol class="breadcrumb flex-lg-nowrap justify-content-center justify-content-lg-start">
                <li class="breadcrumb-item"><a class="text-nowrap" href="/"><i class="ci-home"></i>Home</a></li>
                <li class="breadcrumb-item text-nowrap"><a href="#">Blog</a></li>
                <li class="breadcrumb-item text-nowrap active" aria-current="page">Single post</li>
            </ol>
            </nav>
        </div>
        <div class="order-lg-1 pe-lg-4 text-center text-lg-start">
            <h1 class="h3 mb-0">{{ post.title }}</h1>
        </div>
    </div>
</div>
<div class="container pb-5">
    <div class="row pt-5 mt-md-2">
    <section class="col-lg-8">
        <!-- Post meta-->
        <div class="d-flex flex-wrap justify-content-between align-items-center pb-4 mt-n1">
            <div class="d-flex align-items-center fs-sm mb-2">
                <a class="blog-entry-meta-link" href="{% url 'profile' post.author.profile.slug %}">
                    <div class="blog-entry-author-ava"><img src="{% static 'img/avatar.png' %}" alt="{{post.author.get_full_name}}"></div>{{post.author.get_full_name}}</a>
                <span class="blog-entry-meta-divider"></span><a class="blog-entry-meta-link" href="#">{{ post.publish|date:"l, j F Y" }}</a></div>
            <div class="fs-sm mb-2"><a class="blog-entry-meta-link text-nowrap" href="#comments" data-scroll><i class="ci-message"></i>{{ comments_count }}</a></div>
        </div>
        <!-- Gallery-->
        <div class="gallery row pb-2 justify-content-center">
            <div class="col-sm-10">
                <a class="gallery-item rounded-3 mb-grid-gutter" href="{{ post.featured_image.url }}" data-bs-sub-html="&lt;h6 class=&quot;fs-sm text-light&quot;&gt;{{ post.title }}&lt;/h6&gt;">
                    <img src="{{ post.featured_image.url }}" alt="Gallery image">
                <span class="gallery-item-caption">{{ post.title }}</span></a>
            </div>
        </div>
        <!-- Post content-->
        {{ post.body|safe }}
        <!-- Post tags + sharing-->
        <div class="d-flex flex-wrap justify-content-between pt-2 pb-4 mb-1">
            <div class="mt-3 me-3"><strong>Tags: &ensp;</strong> {% for tag in post.tags.all %}<a class="btn-tag me-2 mb-2" href="{% url 'post_tag' tag.slug %}"># {{tag.name}}</a>{% if not forloop.last %} {% endif %} {% endfor %}</div>
            <div class="mt-3"><span class="d-inline-block align-middle text-muted fs-sm me-3 mt-1 mb-2">Share post:</span>
                <a class="btn-social bs-facebook me-2 mb-2" href="https://www.facebook.com/sharer/sharer.php?u=https://{{domain}}{{ post.get_absolute_url }}" target="_blank"><i class="ci-facebook"></i></a>
                <a class="btn-social bs-twitter me-2 mb-2" href="https://twitter.com/share?url=https://{{domain}}{{ post.get_absolute_url }}&amp;text=Simple%20Share%20Buttons&amp;hashtags=simplesharebuttons" target="_blank"><i class="ci-twitter"></i></a>
                <a class="btn-social bs-instagram me-2 mb-2" href="https://www.instagram.com/?url=https://{{domain}}{{ post.get_absolute_url }}" target="_blank"><i class="ci-instagram"></i></a>
            </div>
        </div>
        <!-- Post navigation-->
        <nav class="entry-navigation" aria-label="Post navigation">
            {% if post.previous_post %}
            <a class="entry-navigation-link" href="{{ post.next_post.get_absolute_url }}" data-bs-toggle="popover" data-bs-placement="top" data-bs-trigger="hover" data-bs-html="true" data-bs-content="&lt;div class=&quot;d-flex align-items-center&quot;&gt;&lt;img src=&quot;{{ post.previous_post.featured_image.url }}&quot; width=&quot;60&quot; class=&quot;rounded&quot; alt=&quot;Post thumb&quot;&gt;&lt;div class=&quot;ps-3&quot;&gt;&lt;h6 class=&quot;fs-sm fw-semibold mb-0&quot;&gt;{{ post.previous_post.title }}&lt;/h6&gt;&lt;span class=&quot;d-block fs-xs text-muted&quot;&gt;by {{ post.previous_post.author }}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;"><i class="ci-arrow-left me-2"></i><span class="d-none d-sm-inline">Prev post</span></a>
            {% endif %}
            <a class="entry-navigation-link" href="{% url 'post' %}"><i class="ci-view-list me-2"></i><span class="d-none d-sm-inline">All posts</span></a>
            {% if post.next_post %}
            <a class="entry-navigation-link" href="{{ post.next_post.get_absolute_url }}" data-bs-toggle="popover" data-bs-placement="top" data-bs-trigger="hover" data-bs-html="true" data-bs-content="&lt;div class=&quot;d-flex align-items-center&quot;&gt;&lt;img src=&quot;{{ post.next_post.featured_image.url }}&quot; width=&quot;60&quot; class=&quot;rounded&quot; alt=&quot;Post thumb&quot;&gt;&lt;div class=&quot;ps-3&quot;&gt;&lt;h6  class=&quot;fs-sm fw-semibold mb-0&quot;&gt;{{ post.next_post.title }}&lt;/h6&gt;&lt;span class=&quot;d-block fs-xs text-muted&quot;&gt;by {{ post.next_post.author }}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;"><span class="d-none d-sm-inline">Next post</span><i class="ci-arrow-right ms-2"></i></a>
            {% endif %}
        </nav>
        <!-- Comments-->
        <div class="pt-2 mt-5" id="comments">
            {% with allcomments.count as total_comments %}
            <h2 class="h4">Comments<span class="badge bg-secondary fs-sm text-body align-middle ms-2">{{ total_comments }} {{ total_comments|pluralize }}</span></h2>
            {% endwith %}
            <!-- comment-->
            {% load mptt_tags %}
            {% recursetree comments %}
            <div id="{{ node.id }}" class="d-flex align-items-start py-4 border-bottom"><img class="rounded-circle" src="{{ user.profile.get_avatar }}" width="50" alt="{{ node.user.get_full_name }}">
                <div class="ps-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        {% if node.level < 8 %}
                        {% if user.id %}
                        <h6 class="fs-md mb-0">{{ node.user.get_full_name }}</h6><a class="nav-link-style fs-sm fw-medium" onclick="myFunction({{ node.id }})"><i class="ci-reply me-2"></i>Reply</a>
                        {% else %}
                        <a class="nav-link-style fs-sm fw-medium" href="{% url 'login' %}"><i class="ci-reply me-2"></i>Login to Reply</a>
                        {% endif %}
                        {% endif %}
                    </div>
                    <p class="fs-md mb-1">{{ node.content|safe }}</p>
                    <span class="fs-ms text-muted"><i class="ci-time align-middle me-2"></i>{{ node.publish }}</span>
                </div>
            </div>
            {% if not node.is_leaf_node %}
            <div class="children ps-2 ps-md-5">
                {{ children }}
            </div>
            {% endif %}
            {% endrecursetree %}
            <div class="py-4">
                <nav aria-label="Page navigation example">
                    {% if comments.has_other_pages %}
                    <ul class="pagination">
                        {% if comments.has_previous %}
                        <li class="page-item"><a class="page-link" href="?page={{ comments.previous_page_number }}">Previous</a></li>
                        {% else %}
                        <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                        {% endif %}
                        {% for num in comments.paginator.page_range %}
                        {% if comments.number == l %}
                        <li class="page-item active"><span class="page-link">{{ num }} <span class="sr-only">(current)</span></span></li>
                        {% else %}
                        <li><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                        {% endif %}
                        {% endfor %}
                        {% if comments.has_next %}
                        <li class="page-item"><a class="page-link" href="?page={{ comments.next_page_number }}">Next</a></li>
                        {% else %}
                        <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
                        {% endif %}
                    </ul>
                    {% endif %}
                </nav>
            </div>

            <!-- Post comment form-->
            <div class="card border-0 shadow mt-2 mb-4">
                <div class="card-body" id="myDIV">
                    <div class="d-flex align-items-start"><img class="rounded-circle" src="{{ user.profile.get_avatar }}" width="50" alt="...">
                        <form id="myForm" method="post" class="w-100 needs-validation ms-3" novalidate>
                            {% if user.id %}
                            <div class="mb-3">
                                <h4>Để lại một bình luận:</h4>
                                {% csrf_token %}
                                {{ comment_form.content }}
                                {{ comment_form.media }}
                                <div class="invalid-feedback">Please write your comment.</div>
                            </div>
                            <button class="btn btn-primary btn-sm" type="submit">Post comment</button>
                            {% else %}
                            <h6><a href="{% url 'login' %}">Đăng nhập</a> để bình luận</h6>
                            {% endif %}
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% include "includes/sidebar.html" %}
    </div>
</div>
<!-- Related posts-->
<div class="bg-secondary py-5">
    <div class="container py-3">
        <h2 class="h4 text-center pb-4">You may also like</h2>
        <div class="tns-carousel">
            <div class="tns-carousel-inner" data-carousel-options="{&quot;items&quot;: 2, &quot;controls&quot;: false, &quot;autoHeight&quot;: true, &quot;responsive&quot;: {&quot;0&quot;:{&quot;items&quot;:1},&quot;500&quot;:{&quot;items&quot;:2, &quot;gutter&quot;: 20},&quot;900&quot;:{&quot;items&quot;:3, &quot;gutter&quot;: 20}, &quot;1100&quot;:{&quot;items&quot;:3, &quot;gutter&quot;: 30}}}">
            {% for post in similar_posts %}
            <!-- article-->
            <article><a class="blog-entry-thumb mb-3" href="{{ post.get_absolute_url }}"><img src="{{ post.featured_image.url }}" alt="Post"></a>
                <div class="d-flex align-items-center fs-sm mb-2"><a class="blog-entry-meta-link" href="#">by {{post.author.get_full_name}}</a><span class="blog-entry-meta-divider"></span><a class="blog-entry-meta-link" href="#"> {{ post.publish }}</a></div>
                <h3 class="h6 blog-entry-title"><a href="{{ post.get_absolute_url }}">{{post.title}}</a></h3>
            </article>
            {% empty %}
            <p class="text-muted">Hiện không có bài viết tương tự</p>
            {% endfor %}
            </div>
        </div>
    </div>
</div>



<script>
	function formExit() {
		document.getElementById("newForm").remove();
	}

	function myFunction(id) {
		if (document.contains(document.getElementById("newForm"))) {
			document.getElementById("newForm").remove();
		}
		
		var d1 = document.getElementById(id);
		d1.insertAdjacentHTML('afterend',
			'<form id="newForm" class="form-insert py-2" method="post"> \
				<div class="d-flex justify-content-between"><h4>Reply:</h4><div><button type="button" class="btn btn-outline-secondary btn-sm" onclick="formExit()"">Close</button></div></div> \
				<select name="parent" class="d-none" id="id_parentt"> \
				<option value="' + id + '" selected="' + id + '"></option> \
				</select> \
				<label for="id_content">Content:</label> \
				<textarea name="content" cols="40" rows="5" class="form-control" required id="id_content"></textarea> \
				{% csrf_token %} \
				<button type="submit" class="btn btn-success btn-block mt-2 btn-sm">Submit</button> \
			</form>');
			
	}

	{% comment %} $('#myForm').trigger("reset"); {% endcomment %}
</script>

{% endblock content %}